<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Dialog</title>
    <style>
      :root {
        --background-color: black;
        --dialog-background: rgba(0, 0, 0, 0.55);
        --text-color: white;
        --blur-intensity: 10px;
        --transition-speed: 0.5s;
      }

      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        background-color: var(--background-color);
        display: flex;
        justify-content: center;
        align-items: center;
        height: 100vh;
      }

      #background {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: url("https://neyroospace.de/wp-content/uploads/2024/07/BG_BLUETEST.png")
          no-repeat center center/cover;
        z-index: 0;
      }

      #dialog-system {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1;
      }

      #blurdiv {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0);
        backdrop-filter: blur(var(--blur-intensity));
        transition: backdrop-filter var(--transition-speed) ease-in-out,
          background-color var(--transition-speed) ease-in-out;
        z-index: 1;
        display: none;
      }

      #dialog-container {
        position: relative;
        width: 90%;
        max-width: 600px;
        height: 90dvh;
        display: flex; /* Already set, no need to redefine */
        flex-direction: column;
        justify-content: flex-end;
        z-index: 2;
        display: none;
      }

      @keyframes popCharacter {
        0% {
          transform: scale(1.5);
        }
        100% {
          transform: scale(1);
        }
      }

      .character {
        display: inline-block;
        animation: popCharacter 0.2s ease-in-out forwards;
      }

      @keyframes popUp {
        0% {
          transform: scale(0);
          opacity: 0;
        }
        50% {
          transform: scale(1.1);
          opacity: 1;
        }
        100% {
          transform: scale(1);
          opacity: 1;
        }
      }

      @keyframes expandWidth {
        0% {
          transform: scaleX(0);
          opacity: 0;
        }
        100% {
          transform: scaleX(1);
          opacity: 1;
        }
      }

      #character-video {
        width: 100%;
        height: 50%;
        object-fit: cover;
        opacity: 0;
        transition: opacity var(--transition-speed) ease-in-out;
      }

      #character-video.show {
        opacity: 1;
        animation: popUp 0.5s ease-in-out forwards;
      }

      #dialog-box {
        width: 100%;
        height: 50dvh;
        background-color: var(--dialog-background);
        color: var(--text-color);
        font-family: Arial, sans-serif;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 5vh;
        box-sizing: border-box;
        border-radius: 3vh;
        opacity: 0;
        transform: scaleX(0);
        transform-origin: center;
        transition: opacity var(--transition-speed) ease-in-out,
          transform var(--transition-speed) ease-in-out;
      }

      #dialog-box.show {
        opacity: 1;
        transform: scaleX(1);
      }

      #dialog-text {
        font-size: 1.5em;
        white-space: pre-wrap;
        text-align: center;
        pointer-events: none;
      }

      #trigger-dialog {
        position: absolute;
        top: 20px;
        left: 20px;
        padding: 10px 20px;
        font-size: 1em;
        z-index: 2;
        cursor: pointer;
      }

      #next-indicator {
        position: absolute;
        bottom: 10%;
        left: 50%;
        transform: translateX(-50%);
        width: 15px;
        height: 15px;
        background-color: transparent;
        border: 2px solid var(--text-color);
        border-radius: 50%;
        opacity: 0;
        animation: pulsate 1.5s infinite;
        pointer-events: none;
      }

      @keyframes pulsate {
        0% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.2);
        }
        100% {
          transform: scale(1);
        }
      }

      @media screen and (min-width: 1024px) {
        #character-video {
          height: 75%;
        }

        #dialog-container {
          width: 60%;
          height: 90vh;
          margin: auto;
        }
      }
    </style>
  </head>
  <body>
    <div id="background"></div>
    <button id="trigger-dialog" aria-label="Start Dialog">Start Dialog</button>

    <script>
      // Data structure to hold dialogues
      const dialogues = {
        greeting: [
          "Hallo!<br> Schön, dass du da bist!",
          "Ich habe dich schon sehnsüchtig erwartet, ich brauche nämlich dringend deine Hilfe!",
          "Ich habe diesen rätselhaften Ort entdeckt, eine scheinbar verlassene Anlage.",
          "Nachdem ich mit meinen Sensoren alles nach Hinweisen gescannt habe, muss es sich um eine stillgelegte Energiezentrale handeln.",
        ],
        farewell: ["Goodbye! Thanks for stopping by.", "See you next time!"],
      };

      // State variables
      let currentIndex = 0;
      let isTyping = false;
      let pages = [];
      let currentPageIndex = 0;

      // DOM elements
      const triggerDialogButton = document.getElementById("trigger-dialog");

      // Function to create and insert the dialog-system
      function createDialogSystem() {
        // Create container and its content
        const dialogSystem = document.createElement("div");
        dialogSystem.id = "dialog-system";

        const blurDiv = document.createElement("div");
        blurDiv.id = "blurdiv";

        const dialogContainer = document.createElement("div");
        dialogContainer.id = "dialog-container";

        const characterVideo = document.createElement("video");
        characterVideo.id = "character-video";
        characterVideo.autoplay = true;
        characterVideo.loop = true;
        characterVideo.muted = true;
        characterVideo.playsInline = true;

        const source1 = document.createElement("source");
        source1.src =
          "https://neyroospace.de/wp-content/uploads/2024/07/Tuev_Sprechanimation_Blue_Alpha_h265.mov";
        source1.type = "video/quicktime;codecs=hvc1";
        characterVideo.appendChild(source1);

        const source2 = document.createElement("source");
        source2.src =
          "https://neyroospace.de/wp-content/uploads/2024/07/output-vp9.webm";
        source2.type = "video/webm";
        characterVideo.appendChild(source2);

        const dialogBox = document.createElement("div");
        dialogBox.id = "dialog-box";

        const dialogText = document.createElement("p");
        dialogText.id = "dialog-text";
        dialogBox.appendChild(dialogText);

        const nextIndicator = document.createElement("div");
        nextIndicator.id = "next-indicator";
        dialogBox.appendChild(nextIndicator);

        dialogContainer.appendChild(characterVideo);
        dialogContainer.appendChild(dialogBox);
        dialogSystem.appendChild(blurDiv);
        dialogSystem.appendChild(dialogContainer);

        document.body.appendChild(dialogSystem);

        // Set up event listeners
        dialogBox.addEventListener("click", () => {
          if (!isTyping) showNextDialogue();
        });
      }

      // Function to remove the dialog-system
      function removeDialogSystem() {
        const dialogSystem = document.getElementById("dialog-system");
        if (dialogSystem) {
          document.body.removeChild(dialogSystem);
        }
      }

      // Initialize dialog display
      function showDialog(id) {
        const dialogue = dialogues[id];
        if (!dialogue) return;

        createDialogSystem();
        setupDialogUI();
        pages = dialogue;
        currentPageIndex = 0;
        setTimeout(() => typeText(pages[currentPageIndex]), 1000); // Initial delay
      }

      // Setup initial UI for the dialog
      function setupDialogUI() {
        const dialogBox = document.getElementById("dialog-box");
        const blurDiv = document.getElementById("blurdiv");
        const dialogContainer = document.getElementById("dialog-container");
        const characterVideo = document.getElementById("character-video");
        const nextIndicator = document.getElementById("next-indicator");

        dialogBox.style.display = "flex";
        blurDiv.style.display = "block";
        dialogContainer.style.display = "flex";

        requestAnimationFrame(() => {
          blurDiv.style.backdropFilter = "blur(var(--blur-intensity))";
          blurDiv.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
          characterVideo.classList.add("show");
          dialogBox.classList.add("show");
        });

        const dialogText = document.getElementById("dialog-text");
        dialogText.innerHTML = "";
        currentIndex = 0;
      }

      // Function to handle typing effect
      function typeText(text) {
        let displayText = "";
        isTyping = true;
        const nextIndicator = document.getElementById("next-indicator");
        nextIndicator.style.opacity = 0;

        function typeNextChar() {
          if (currentIndex < text.length) {
            displayText += text[currentIndex];
            document.getElementById("dialog-text").innerHTML = displayText;
            currentIndex++;
            requestAnimationFrame(typeNextChar);
          } else {
            document.getElementById("dialog-text").innerHTML = text;
            isTyping = false;
            nextIndicator.style.opacity = 1;
          }
        }

        requestAnimationFrame(typeNextChar);
      }

      // Show the next dialogue or hide dialog if finished
      function showNextDialogue() {
        if (currentPageIndex < pages.length - 1) {
          currentPageIndex++;
          currentIndex = 0;
          document.getElementById("dialog-text").innerHTML = "";
          document.getElementById("next-indicator").style.opacity = 0;
          setTimeout(() => typeText(pages[currentPageIndex]), 500); // Delay before next text
        } else {
          hideDialogElements();
        }
      }

      // Hide dialog elements
      function hideDialogElements() {
        removeDialogSystem();
      }

      // Trigger dialog on button click
      triggerDialogButton.addEventListener("click", () => {
        showDialog("greeting");
      });
    </script>
  </body>
</html>
